<p-breadcrumb class="max-w-full" [model]="items()">
  <ng-template #item let-item>
    <ng-container *ngIf="item.route; else elseBlock">
      <a [routerLink]="item.route" class="p-breadcrumb-item-link">
        <span [ngClass]="[item.icon ? item.icon : '', 'text-color']"></span>
        <span class="text-primary font-semibold">{{ item.label }}</span>
      </a>
    </ng-container>
    <ng-template #elseBlock>
      <a [href]="item.url">
        <span class="text-color">{{ item.label }}</span>
      </a>
    </ng-template>
  </ng-template>
</p-breadcrumb>

<div class="card">
  <div
    class="font-semibold text-xl mb-4"
    (click)="changeName = true"
    *ngIf="!changeName"
  >
    {{ project()?.name }}
  </div>
  <div class="my-4">
    <!-- <p-button [label]="diagram?.name" text (click)="changeName=true" *ngIf="!changeName"/> -->
    <p-inputgroup *ngIf="changeName">
      <input pInputText [value]="nameDraft" class="w-[25rem]" #nameInputText />
      <p-inputgroup-addon>
        <button
          pButton
          icon="pi pi-save"
          (click)="onNameChange(nameInputText.value)"
        ></button>
        <button pButton icon="pi pi-times" (click)="onCancelName()"></button>
      </p-inputgroup-addon>
    </p-inputgroup>
  </div>

  <p-dataview [value]="project()?.diagrams" [layout]="'grid'">
    <ng-template #header>
      <div class="flex justify-end">
        <p-button
          *ngIf="(project()?.diagrams?.length ?? 0) > 0 || false"
          icon="pi pi-plus"
          text
          raised
          rounded
          (click)="project() && newDiagram()"
        />
      </div>
    </ng-template>

    <ng-template #emptymessage>
      <div class="text-center text-surface-500 dark:text-surface-400 py-4">
        <div class="mb-8">No graph found.</div>
        <p-button
          label="Add a new graph"
          icon="pi pi-plus"
          variant="text"
          severity="success"
          (click)="project() && newDiagram()"
        />
      </div>
    </ng-template>

    <ng-template #loadingmessage>
      <div class="text-center text-surface-500 dark:text-surface-400 py-4">
        <div class="mb-8">Loading...</div>
      </div>
    </ng-template>

    <ng-template #grid let-items>
      <div class="grid grid-cols-12 gap-4">
        <div
          *ngFor="let item of items; let i = index"
          class="col-span-6 sm:col-span-4 lg:col-span-3 p-2"
        >
          <div
            class="p-6 border border-surface-200 dark:border-surface-700 bg-surface-0 dark:bg-surface-900 rounded flex flex-col transition-all duration-200 hover:shadow-lg hover:border-primary-500 cursor-pointer h-full animate-once animate-duration-500 animate-zoomin"
            (click)="project() && selectDiagram(item.id)"
          >
            <div class="flex flex-col items-end">
              <div class="flex gap-2">
                <p-button
                  icon="pi pi-times"
                  size="small"
                  [rounded]="true"
                  [text]="true"
                  severity="danger"
                  (click)="deleteDiagram(item); $event.stopPropagation()"
                  pTooltip="Delete"
                />
              </div>
            </div>
            <div class="flex justify-center rounded">
              <div class="relative mx-auto">
                <div class="text-center">
                  <app-logo width="30%" />
                </div>
              </div>
            </div>
            <div>
              <div class="flex flex-row justify-between items-start gap-2">
                <div>
                  <span
                    class="font-medium text-surface-500 dark:text-surface-400 text-sm"
                    >{{ item.category }} cat</span
                  >
                  <div class="text-2xl font-medium mt-1">{{ item.name }}</div>
                </div>
              </div>
              <div class="flex flex-col gap-6 mt-6">
                <span
                  class="text-lg font-medium text-surface-500 dark:text-surface-400"
                  >---</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-template>

    <ng-template #footer>
      <div
        class="flex justify-end"
        *ngIf="(project()?.diagrams?.length ?? 0) > 0"
      >
        {{ project()?.diagrams?.length }}
        {{ (project()?.diagrams?.length ?? 0) > 1 ? "diagrams" : "diagram" }}
      </div>
    </ng-template>
  </p-dataview>
</div>

<p-confirmDialog></p-confirmDialog>

<p-toast position="bottom-right" key="br" />
